- name: Appliquer la définition de l'application ArgoCD
  hosts: master
  become: true
  tasks:
    - name: Copier le fichier argocd_app.yaml généré par Terraform
      copy:
        src: /tmp/argocd_app.yaml
        dest: /tmp/argocd_app.yaml
        mode: '0644'

    - name: Appliquer la ressource ArgoCD Application
      shell: |
        kubectl apply -f /tmp/argocd_app.yaml --kubeconfig=/etc/kubernetes/admin.conf
      args:
        executable: /bin/bash
      environment:
        KUBECONFIG: /etc/kubernetes/admin.conf